# Database Schema

This document describes the MongoDB database structure, including collections, fields, and relationships between entities.

## Overview

The system models committee-based decision making with users, committees, motions, debates, and votes.

### Core Data Objects

- User
- Committee
- Membership
- Motion
- Debate
- Vote

### High-Level Relationship Summary

- A User can belong to many Committees (via Memberships)
- A Committee can have many Motions
- A Motion:
  - Has one author (User)
  - Has many Debates
  - Has many Votes
  - Debates and Votes are always tied to a single Motion

## Collections

### 1. Users

Stores application users. User data is synchronized with Auth0.

| Field       | Type   | Description                                            |
| ----------- | ------ | ------------------------------------------------------ |
| `_id`       | String | Auth0 user identifier (e.g., "auth0\|123456")          |
| `username`  | String | Display name (unique, sparse index)                    |
| `email`     | String | User email (synced with Auth0)                         |
| `firstName` | String | User first name                                        |
| `lastName`  | String | User last name                                         |
| `pronouns`  | String | User pronouns (e.g., "he/him", "she/her", "they/them") |
| `about`     | String | User bio/description (max 2000 characters)             |
| `createdAt` | Date   | Timestamp when the user was created                    |
| `updatedAt` | Date   | Timestamp when the user was last updated               |

**Notes**:

- The `_id` field is set to the Auth0 user ID (String) instead of MongoDB ObjectId
- Username has a unique sparse index (allows multiple null values)
- All string fields are trimmed automatically

### 2. Committees

Represents a governing or decision-making body.

| Field             | Type     | Description                                           |
| ----------------- | -------- | ----------------------------------------------------- |
| `_id`             | ObjectId | Unique identifier generated by MongoDB                |
| `name`            | String   | Name of the committee (required)                      |
| `description`     | String   | Description of the committee (optional)               |
| `votingThreshold` | String   | `"MAJORITY"` or `"SUPERMAJORITY"` (default: MAJORITY) |
| `anonymousVoting` | Boolean  | Whether votes are anonymous (default: false)          |
| `createdAt`       | Date     | Timestamp when the committee was created              |
| `updatedAt`       | Date     | Timestamp when the committee was last updated         |

**Voting Thresholds**:

- `MAJORITY`: Simple majority (> 50%) required to pass motions
- `SUPERMAJORITY`: Two-thirds majority (≥ 2/3) required to pass motions

### 3. Memberships

Defines the relationship between users and committees, including roles and permissions.

| Field         | Type     | Description                            |
| ------------- | -------- | -------------------------------------- |
| `_id`         | ObjectId | Unique identifier generated by MongoDB |
| `userId`      | String   | Reference to `users._id` (Auth0 ID)    |
| `committeeId` | ObjectId | Reference to `committees._id`          |
| `role`        | String   | `"MEMBER"`, `"CHAIR"`, or `"OWNER"`    |
| `createdAt`   | Date     | Timestamp membership was created       |
| `updatedAt`   | Date     | Timestamp membership was last updated  |

#### Definition of Roles and Permissions

As outlined in the table, there are three main roles within a committee. Each role is provided certain permissions.

**MEMBER**

- Propose motions
- Second motions (if not author)
- Debate motions
- Vote on motions

**CHAIR**

- All MEMBER permissions
- Approve or veto seconded motions
- Open voting phase after debate

**OWNER**

- All MEMBER permissions
- Create committees
- Add/remove members
- Change member roles

### 4. Motions

Represents proposals introduced within a committee.

| Field              | Type     | Description                                     |
| ------------------ | -------- | ----------------------------------------------- |
| `_id`              | ObjectId | Unique identifier generated by MongoDB          |
| `committeeId`      | ObjectId | Reference to `committees._id`                   |
| `authorId`         | String   | Reference to `users._id` (Auth0 ID)             |
| `title`            | String   | Short summary of the motion (required)          |
| `description`      | String   | Detailed description of the motion (required)   |
| `status`           | String   | Current motion status (default: "PROPOSED")     |
| `originalMotionId` | ObjectId | Reference to original motion if this is amended |
| `createdAt`        | Date     | Timestamp motion was created                    |
| `updatedAt`        | Date     | Timestamp motion was last updated               |

#### Definition of Motion Statuses

| Status     | Description                              |
| ---------- | ---------------------------------------- |
| `PROPOSED` | Motion created                           |
| `SECONDED` | Motion seconded, awaiting chair approval |
| `VETOED`   | Chair rules motion out of order          |
| `DEBATE`   | Motion under discussion                  |
| `VOTING`   | Voting in progress                       |
| `PASSED`   | Motion approved                          |
| `REJECTED` | Motion failed                            |

#### Motion Status Lifecycle

### 5. Debates

Stores discussion points made by users during a motion’s debate phase.

| Field       | Type     | Description                             |
| ----------- | -------- | --------------------------------------- |
| `_id`       | ObjectId | Unique identifier generated by MongoDB  |
| `motionId`  | ObjectId | Reference to `motions._id`              |
| `authorId`  | String   | Reference to `users._id` (Auth0 ID)     |
| `position`  | String   | `"SUPPORT"`, `"OPPOSE"`, or `"NEUTRAL"` |
| `content`   | String   | Argument text (required)                |
| `createdAt` | Date     | Timestamp debate entry was created      |
| `updatedAt` | Date     | Timestamp debate entry was last updated |

### 6. Votes

Represents a user’s vote on a motion.

| Field       | Type     | Description                            |
| ----------- | -------- | -------------------------------------- |
| `_id`       | ObjectId | Unique identifier generated by MongoDB |
| `motionId`  | ObjectId | Reference to `motions._id`             |
| `authorId`  | String   | Reference to `users._id` (Auth0 ID)    |
| `position`  | String   | `"SUPPORT"` or `"OPPOSE"` (required)   |
| `createdAt` | Date     | Timestamp vote was created             |
| `updatedAt` | Date     | Timestamp vote was last updated        |

**Notes**:

- Each user can only vote once per motion (enforced at application level)
- When voting threshold is reached, motion status automatically updates
