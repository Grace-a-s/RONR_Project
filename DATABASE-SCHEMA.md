# Database Schema

This document describes the MongoDB database structure, including collections, fields, and relationships between entities.

## Table of Contents

- [Overview](#overview)
  - [Core Data Objects](#core-data-objects)
  - [High-Level Relationship Summary](#high-level-relationship-summary)
- [Collections](#collections)
  - [1. Users](#1-users)
  - [2. Committees](#2-committees)
  - [3. Memberships](#3-memberships)
  - [4. Motions](#4-motions)
  - [5. Debates](#5-debates)
  - [6. Votes](#6-votes)

## Overview

The system models committee-based decision making with users, committees, motions, debates, and votes.

### Core Data Objects

- User
- Committee
- Membership
- Motion
- Debate
- Vote

### High-Level Relationship Summary

- A User can belong to many Committees (via Memberships)
- A Committee can have many Motions
- A Motion:
  - Has one author (User)
  - Has many Debates
  - Has many Votes
  - Debates and Votes are always tied to a single Motion

## Collections

### 1. Users

Stores application users. User data is synchronized with Auth0.

| Field       | Type   | Description                                            |
| ----------- | ------ | ------------------------------------------------------ |
| `_id`       | String | Auth0 user identifier (e.g., "auth0\|123456")          |
| `username`  | String | Display name (unique)                                  |
| `email`     | String | User email (synced with Auth0)                         |
| `firstName` | String | User first name                                        |
| `lastName`  | String | User last name                                         |
| `pronouns`  | String | User pronouns (e.g., "he/him", "she/her", "they/them") |
| `about`     | String | User bio/description (max 2000 characters)             |
| `createdAt` | Date   | Timestamp when the user was created                    |
| `updatedAt` | Date   | Timestamp when the user was last updated               |

**Notes**:

- User authentication is handled with Auth0. The `_id` field is set to the Auth0 user ID (String) instead of MongoDB ObjectId

### 2. Committees

Represents governing or decision-making bodies.

| Field             | Type     | Description                                           |
| ----------------- | -------- | ----------------------------------------------------- |
| `_id`             | ObjectId | Unique identifier generated by MongoDB                |
| `name`            | String   | Name of the committee (required)                      |
| `description`     | String   | Description of the committee (optional)               |
| `votingThreshold` | String   | `"MAJORITY"` or `"SUPERMAJORITY"` (default: MAJORITY) |
| `anonymousVoting` | Boolean  | Whether votes are anonymous (default: false)          |
| `createdAt`       | Date     | Timestamp when the committee was created              |
| `updatedAt`       | Date     | Timestamp when the committee was last updated         |

**Voting Thresholds**:

- `MAJORITY`: Simple majority (> 50%) required to pass motions
- `SUPERMAJORITY`: Two-thirds majority (≥ 2/3) required to pass motions

### 3. Memberships

Defines the relationship between users and committees, including roles and permissions.

| Field         | Type     | Description                            |
| ------------- | -------- | -------------------------------------- |
| `_id`         | ObjectId | Unique identifier generated by MongoDB |
| `userId`      | String   | Reference to `users._id` (Auth0 ID)    |
| `committeeId` | ObjectId | Reference to `committees._id`          |
| `role`        | String   | `"MEMBER"`, `"CHAIR"`, or `"OWNER"`    |
| `createdAt`   | Date     | Timestamp membership was created       |
| `updatedAt`   | Date     | Timestamp membership was last updated  |

**Roles**:

- `MEMBER`: Standard participants in the committee who can fully participate in the deliberative process
- `CHAIR`: Manages the governance and procedural aspects of the committee
- `OWNER`: Ability to manage the roles of other users within the committee. This role is automatically assigned to the person who created the committee

### 4. Motions

Represents proposals introduced within a committee.

| Field              | Type     | Description                                     |
| ------------------ | -------- | ----------------------------------------------- |
| `_id`              | ObjectId | Unique identifier generated by MongoDB          |
| `committeeId`      | ObjectId | Reference to `committees._id`                   |
| `authorId`         | String   | Reference to `users._id` (Auth0 ID)             |
| `title`            | String   | Short summary of the motion (required)          |
| `description`      | String   | Detailed description of the motion (required)   |
| `status`           | String   | Current motion status (default: "PROPOSED")     |
| `originalMotionId` | ObjectId | Reference to original motion if this is amended |
| `createdAt`        | Date     | Timestamp motion was created                    |
| `updatedAt`        | Date     | Timestamp motion was last updated               |

**Motion Statuses**:

- `PROPOSED`: Motion created
- `SECONDED`: Motion seconded, awaiting chair approval
- `VETOED`: Chair rules motion out of order
- `DEBATE`: Motion under discussion
- `VOTING`: Voting in progress
- `PASSED`: Motion approved
- `REJECTED`: Motion failed

### 5. Debates

Stores discussion points made by users during a motion’s debate phase.

| Field       | Type     | Description                             |
| ----------- | -------- | --------------------------------------- |
| `_id`       | ObjectId | Unique identifier generated by MongoDB  |
| `motionId`  | ObjectId | Reference to `motions._id`              |
| `authorId`  | String   | Reference to `users._id` (Auth0 ID)     |
| `position`  | String   | `"SUPPORT"`, `"OPPOSE"`, or `"NEUTRAL"` |
| `content`   | String   | Argument text (required)                |
| `createdAt` | Date     | Timestamp debate entry was created      |
| `updatedAt` | Date     | Timestamp debate entry was last updated |

### 6. Votes

Represents a user’s vote on a motion.

| Field       | Type     | Description                            |
| ----------- | -------- | -------------------------------------- |
| `_id`       | ObjectId | Unique identifier generated by MongoDB |
| `motionId`  | ObjectId | Reference to `motions._id`             |
| `authorId`  | String   | Reference to `users._id` (Auth0 ID)    |
| `position`  | String   | `"SUPPORT"` or `"OPPOSE"` (required)   |
| `createdAt` | Date     | Timestamp vote was created             |
| `updatedAt` | Date     | Timestamp vote was last updated        |

**Notes**:

- Each user can only vote once per motion (enforced at application level)
- When voting threshold is reached, motion status automatically updates
